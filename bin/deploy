#!/bin/bash

# ================================================
# Description: Deploy current project happy
# Last Modified: Mon Jan 13, 2014 08:35PM
# Author: Allex Wang (allex.wxn@gmail.com)
# ================================================

CUR_DIR=$PWD
TARGET=$1
ARGS=("${@}")

ARGS[${#ARGS[@]}]="-Dlog4j_level=error"
ARGS[${#ARGS[@]}]="-Drose_log4j_level=error"

if [ "${TARGET}x" != "x" ] && [ -d $CUR_DIR/$TARGET ]; then
    ARGS=(${ARGS[@]:1})
    cd $CUR_DIR/$TARGET
    if [ -f "$CUR_DIR/$TARGET/release.sh" ]; then
        sh ./release.sh "${ARGS[@]}"
    else
        mvn clean install "${ARGS[@]}"
    fi
    cd - >/dev/null 2>&1
    exit 0;
fi

PROJ_DIR=`CP=${CUR_DIR}; while [ -n "$CP" ] ; do if [ -f "$CP/release.sh" ] || [ -f "$CP/pom.xml" ]; then echo $CP; break; fi; CP=${CP%/*}; done;`
if [ -n "$PROJ_DIR" ]; then
    echo "Building ${PROJ_DIR} ..."
    cd "$PROJ_DIR"
    if [ -f "$PROJ_DIR/release.sh" ]; then
        sh ./release.sh "${ARGS[@]}"
    else
        if [ -f "$PROJ_DIR/pom.xml" ]; then
            mvn clean install "${ARGS[@]}"
        fi
    fi
    cd "$CUR_DIR"
fi
exit 0;

# find -name "*.thrift" -exec thrift --gen java:beans {} \;
