#!/bin/bash

# Google Closure Compiler (GCC) Toolkit

# Author: Allex (allex.wxn@gmail.com)
# Last Modified: Wed Aug 22, 2012 10:17AM

COMPILER="$LIB/compiler.jar"
GCC="java -Xms64m -Xmx128m -Djava.library.path=$LIB -jar $COMPILER"

# For more see http://code.google.com/p/closure-compiler/wiki/Warnings
args="--charset UTF-8 --language_in=ECMASCRIPT5_STRICT"

# --warning_level VERBOSE|DEFAULT|QUIET
warning_level="DEFAULT";

usage() {
    $GCC --help;
}

while [ $# -gt 0 ]
do
    case $1 in
        -t|--warning_level)
            warning_level=$2;

            case ${warning_level} in
                (QUIET|DEFAULT|VERBOSE)
                    shift;
                    ;;
                (*) warning_level="DEFAULT";
                    if [ "$1" == "-t" ]; then
                        warning_level="VERBOSE";
                    fi
                    ;;
            esac
            ;;

        -h|--help|-\?) usage; exit;;
        (--) shift; break;;

        (*) arg=$1;
            if [ "${arg:0:1}" != "-" ]; then
                args="${args} --js ${arg}";
            else
                args="${args} $arg $2";
                shift;
            fi
            ;;
    esac
    shift
done

args="${args} --warning_level ${warning_level}"

# stdin
if [ ! -t 0 ]; then
    $GCC ${args} < /dev/stdin

# filepath
elif [ $(expr "${args}" : ".* --js .*") -ne 0 ]; then
    $GCC ${args}

# usage
else
    usage;
fi
